<!-- 모달 내용 -->
<div class="modal fade" id="addCurencyModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header alert alert-success">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">거래 내역 입력</h4>
      </div>

      <div class="modal-body">
        <form role="form" id="transactionForm">
          <!-- 첫째 줄 -->
          <div class="row">
            <!-- 날짜 입력 -->
            <div class="col-md-6">
              <div class="form-group">
                <label class="control-label text-success">거래 날짜</label>
                <input name="date" id="date" type="text" class="form-control input-sm" placeholder="날짜를 입력하세요" size="30">
              </div>
            </div>
            <!-- 날짜 입력 -->
            <div class="col-md-6">
              <div class="form-group">
                <label class="control-label text-success">카테고리</label>
                <input id="category" name="category" type="text" class="form-control input-sm" placeholder="카테고리를 입력하세요">
              </div>
            </div>
          </div>
          <!-- 첫째 줄 -->

          <!-- 둘째 줄 -->
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="control-label text-success">냥 주는 이</label>
                <input id="sender" name="sender" type="text" class="form-control input-sm" placeholder="이름을 입력하세요">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="control-label text-success">냥 받는 이</label>
                <input id="receiver" name="receiver" type="text" class="form-control input-sm" placeholder="이름을 입력하세요">
              </div>
            </div>
          </div>
          <!-- 둘째 줄 -->

          <div class="form-group">
            <p class="help-block">*냥 받는 이의 승인이 되면 거래가 완료됩니다.
          </div>

          <!-- 거래 내용 -->
          <div class="form-group">
            <label class="control-label text-success">거래 내용</label>
            <input id="description" name="description" type="text" class="form-control input-sm" placeholder="내용을 입력하세요">
          </div>
          <!-- 거래 내용 -->

          <!-- 현금 입력폼 -->
          <!-- <p>
            <label class="control-label text-success">거래한 현금</label>
            <div class="input-group">
              <input name="amountCash" type="text" class="form-control" placeholder="금액을 입력하세요">
              <span class="input-group-addon">원</span>
            </div>
          </p> -->
          <!-- 현금 입력폼 -->

          <!-- 노냥 입력폼 -->
          <div class="form-group">
            <label class="control-label text-success">거래한 노냥</label>
            <div class="input-group">
              <input id="amountPoint" name="amountPoint" type="text" class="form-control" placeholder="금액을 입력하세요">
              <span class="input-group-addon">냥</span>
            </div>
          </div>
          <!-- 노냥 입력폼 -->

          <div class="form-group">
            <p class="help-block">*<strong>[냥 주는 이]</strong>와 <strong>[냥 받는 이]</strong>, <strong>[카테고리]</strong> 항목은 되도록이면 자동완성을 기능을 이용하세요.</p>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">그냥 닫기</button>
          <input class="btn btn-success" type="submit" value="입력하기">
        </div>
      </form>
    </div>
  </div>
</div>
<!-- 모달 내용 -->
<style>
  ul.ui-autocomplete {
    z-index: 1100;
  }
</style>
<script>
$(document).ready(function() {
  $('#transactionForm').validate({
    // Style error message and input box
    highlight: function(element) {
      $(element).closest('.form-group').addClass('has-error');
    },
    unhighlight: function(element) {
      $(element).closest('.form-group').removeClass('has-error');
    },
    errorElement: 'span',
    errorClass: 'help-block',
    errorPlacement: function(error, element) {
      if(element.parent('.input-group').length) {
        error.insertAfter(element.parent());
      } else {
        error.insertAfter(element);
      }
    },
    rules: {
      date: {
        required: true
      },
      category: {
        required: true
      },
      sender: {
        required: true
      },
      receiver: {
        required: true
      },
      amountPoint: {
        required: true,
        number: true
      },
    },
    submitHandler: function (form) {
      $.ajax({
        type: 'POST',
        url: '/transaction/create',
        data: $(form).serialize(),
        success: function (data, status) {
          window.location = '/';
          console.log('success');
        },
        error: function (error) {
          alert(error.responseText);
          console.log(error);
          return false;
        }
      });
      return false;
    }
  });

  // Initialize date picker
  var $datePicker = $( "#date" );
  $datePicker.datepicker({
    'dateFormat': 'yy년 mm월 dd일'
  });
  $datePicker.datepicker( "setDate", new Date());

  // Sender and receiver autocomplete
  $.ajax({
    type: 'GET',
    url: '/users/all',
    success: function (data, status) {
      var availableUsers = [];

      for ( var i in data.data ) {
        availableUsers[i] = data.data[i].name;
      }

      $('#sender').autocomplete({
        source: availableUsers
      });
      $('#receiver').autocomplete({
        source: availableUsers
      });
    },
    error: function (error) {
      alert('users: ' + error.statusText);
      return false;
    }
  });

  // Category autocomplete
  $.ajax({
    type: 'GET',
    url: '/category/all',
    success: function (data, status) {
      var availableCategories = [];

      for ( var i in data.data ) {
        availableCategories[i] = data.data[i].name;
      }

      $('#category').autocomplete({
        source: availableCategories
      });
    },
    error: function (error) {
      alert('categories: ' + error.statusText);
      return false;
    }
  });
});

</script>