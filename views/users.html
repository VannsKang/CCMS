{% extends 'layout.html' %}

{% block title %} USERS.HTML {% endblock %}

{% block head %}
  {% parent %}
  <link rel="stylesheet" href="./css/style.css" />

  <style>
    ul.ui-autocomplete {
      z-index: 1100;
    }
  </style>

  <script type="text/javascript">

  $(document).ready(function() {
    $('#createUserForm').validate({
      // Style error message and input box
      highlight: function(element) {
        $(element).closest('.form-group').addClass('has-error');
      },
      unhighlight: function(element) {
        $(element).closest('.form-group').removeClass('has-error');
      },
      errorElement: 'span',
      errorClass: 'help-block',
      errorPlacement: function(error, element) {
        if(element.parent('.input-group').length) {
          error.insertAfter(element.parent());
        } else {
          error.insertAfter(element);
        }
      },
      rules: {
        email: {
          required: true,
          email: true
        },
        name: {
          required: true,
          minlength: 2
        },
        password: {
          required: true,
          minlength: 6
        },
        passwordConfirm: {
          required: true,
          minlength: 6
        },
        recomender: {
          required: true,
          email: true
        }
      },
      messages: {
        email: {
          required: "이메일 주소를 제대로 입력해주세요",
          email: "아이디는 반드시 이메일 주소 형식이어야 합니다"
        },
        name: {
          required: "이름을 제대로 입력해주세요",
          minlength: jQuery.format("최소한 {0} 글자 이상 입력해주세요")
        },
        password: {
          required: "패스워드를 제대로 입력해주세요",
          minlength: jQuery.format("최소한 {0} 글자 이상 입력해주세요")
        },
        passwordConfirm: {
          required: "패스워드를 제대로 입력해주세요",
          minlength: jQuery.format("최소한 {0} 글자 이상 입력해주세요")
        },
        recomender: {
          required: "추천인 이메일 주소를 제대로 입력해주세요",
          email: "추천인은 이메일 주소 형식이어야 합니다"
        }     
      },
      submitHandler: function (form) {
        $.ajax({
          type: 'POST',
          url: '/users/create',
          data: $(form).serialize(),
          success: function (data, status) {
            window.location = '/';
            console.log('success');
          },
          error: function (error) {
            alert(error.responseText);
            console.log(error);
            return false;
          }
        });
        return false;
      }
    });
  });
  </script>
{% endblock %}

{% block content %}
<div class="container">
  
  <!-- 제목 -->
  <header>  <div class="alert alert-info h4">회원 가입</div> </header>
  <!-- 제목 -->
  
  <!-- validate 걸어줄 폼 잡기 -->
  <form role="form" id="createUserForm">

    <!-- 첫째 줄 -->
    <div class="row">
      
      <!-- 아이디 입력 -->
      <div class="col-md-6">
        <div class="form-group">
          <label class="control-label text-info">아이디 (메일 주소)</label>
          <input type="email" name="email" class="form-control input-sm" placeholder="메일 주소를 입력해주세요">
        </div>      
      </div>
      <!-- 아이디 입력 -->

      <!-- 이름 입력 -->
      <div class="col-md-6">
        <div class="form-group">
          <label class="control-label text-info">이름</label>                        
          <input type="text" name="name" class="form-control input-sm" placeholder="이름을 입력해주세요">
        </div>
      </div>
      <!-- 이름 입력 -->
        
    </div>
    <!-- 첫째 줄 -->

    <!-- 둘째 줄 -->
    <div class="row">

      <!-- 패스워드 입력 -->
      <div class="col-md-6">    
        <div class="form-group">
          <label class="control-label text-info">패스워드</label>
          <input type="password" name="password" class="form-control input-sm" placeholder="변경할 패스워드를 입력하세요">
        </div>    
      </div>
      <!-- 패스워드 입력 -->

      <!-- 패스워드 입력 확인 -->
      <div class="col-md-6">
        <div class="form-group">
          <label class="control-label text-info">패스워드 확인</label>
          <input type="password" name="passwordConfirm" class="form-control input-sm" placeholder="패스워드를 재입력해주세요">
        </div>
      </div>            
      <!-- 패스워드 입력 확인 -->

    </div>
    <!-- 둘째 줄 -->  

    <!-- 사진 업로드 -->
    <div class="form-group">
      <label class="control-label text-info">사진 올리기</label>
      <input type="file" id="InputFile" name="upload">
      <p class="help-block">프로필 사진을 업로드해주세요.</p>
    </div>
    <!-- 사진 업로드 -->    

    <!-- 자기소개폼 -->
    <div class="form-group">
      <label class="control-label text-info">자기 소개</label>
      <textarea class="form-control" name="description" rows="3" placeholder="간단한 자기소개를 해주세요"></textarea>
    </div>
    <!-- 자기소개폼 -->

    <!-- 추천인 입력 -->
    <div class="row">
      <div class="col-md-6">
        <div class="form-group">
          <label class="control-label text-info">추천인 (메일 주소)</label>                        
          <input type="email" name="recomender" class="form-control input-sm" placeholder="이메일을 입력해주세요">
        </div>
      </div>
    </div>
    <!-- 추천인 입력 -->

    <!-- 메일 수신 확인 체크 박스-->
    <div class="checkbox">
      <label>
        <input type="checkbox" name="checkEmail" value="">
          노냥에 대한 중요한 정보를 메일로 수신하겠습니다.
      </label>
    </div>
    <!-- 메일 수신 확인 체크 박스-->

    <!-- 푸터 -->
    <footer class="text-right">
      <a href="/" type="button" class="btn btn-default">되돌아가기</a>    
      <input class="btn btn-info" type="submit" value="가입하기">
    </footer>
    <!-- 푸터 -->

  </form>
  <!-- validate 걸어줄 폼 잡기 -->

</div>

<!-- <div style="margin: 10px;">
  <form action="/users/create" method="POST">
    EMAIL: <input type="text" name="email"/><br />
    PASSWORD: <input type="password" name="password"/><br />
    NAME: <input type="text" name="name"/><br />
    <input type="submit" value="회원가입"/>
  </form>
</div>
 -->
<ol style="margin: 10px;"><!-- Ordered List -->
{% for user in users %}
  <li>
    <ul><!-- Unordered List -->
      <li>ID: {{ user.id }}</li>
      <li>NAME: {{ user.name }}</li>
      <li>EMAIL: {{ user.email }}</li>
      {% if user.recommender %}
      <li>Recommender: {{ user.recommender }}</li>
      {% endif %}
    </ul>
  </li>
{% endfor %}
</ol><!-- Ordered List -->

{% endblock %}